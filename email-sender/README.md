JOT Email Sender
=================

Summary
-------
Small Node.js service that generates Firebase email verification links and sends them via SendGrid. This setup improves deliverability because you send from a verified sending domain (SendGrid) and keep verification links generated by Firebase.

Why this helps deliverability
- Use a reputable transactional email provider (SendGrid) with DKIM/SPF.
- Send from a domain you control (set FROM_EMAIL like no-reply@yourdomain.com).
- Add SPF, DKIM, and DMARC DNS records for the sending domain.

Quick setup
-----------
1. Create a SendGrid account and add your sending domain. Follow SendGrid steps to set SPF/DKIM records in your DNS.
2. Create a Firebase service account JSON and base64-encode it for the env var:

   Windows PowerShell example:

```powershell
$json = Get-Content C:\path\to\serviceAccount.json -Raw
[Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes($json)) | Out-File -Encoding ascii fa.txt; Get-Content fa.txt
```

3. Create a .env file in this folder with:

```
FIREBASE_SERVICE_ACCOUNT=<base64 JSON string from step 2>
SENDGRID_API_KEY=SG.xxxxx
FROM_EMAIL=no-reply@yourdomain.com
AFTER_VERIFY_URL=https://yourdomain.com/login
PORT=3001
```

Optional environment variables:
- FROM_NAME=Jot Talent Competitions
- REPLY_TO=support@yourdomain.com

4. Install dependencies and run:

```powershell
cd "e:\JOT WORK\Jot Talent Competitions\email-sender"
npm install
npm start
```

Use from your app
-----------------
Call POST /sendVerification with JSON { "email": "user@example.com" }.

Deliverability checklist
-----------------------
- Use a sending domain (not a free @gmail) in FROM_EMAIL.
- Add SPF record: include SendGrid (example: "v=spf1 include:sendgrid.net -all").
- Add DKIM records from SendGrid and wait for DNS propagation.
- Add a DMARC policy for monitoring (p=none) before enforcing.
- Ensure FROM and Reply-To are from the verified domain.
- Keep message content short, include clear unsubscribe info if sending bulk emails.

Testing tips:
- Use mail-tester.com to get a spam-score for your message and fix any issues flagged.
- Send test emails to Gmail/Outlook/Yahoo and inspect the full headers to confirm SPF and DKIM pass.

Notes
-----
- This is an example service; for production use secure the endpoint (auth token) and rate-limit requests.
- If you're already using Firebase's built-in sendEmailVerification (client SDK), switching to a transactional provider like SendGrid with generated links often improves inbox placement.
